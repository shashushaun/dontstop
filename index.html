<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒ³ãƒˆã‚¹ãƒˆãƒƒãƒ—ã—ã‚‡ãƒ¼ã‚“</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
            background-color: #f0f0f0;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        .button {
            position: absolute;
            padding: 10px 20px;
            font-size: 20px;
            color: white;
            background-color: #4CAF50;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }
        #pause-button, #resume-button, #reset-button {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        #pause-button {
            left: calc(50% - 70px); /* ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ã‚’å·¦ã«èª¿æ•´ */
        }
        #resume-button {
            left: calc(50% - 70px); /* å†é–‹ãƒœã‚¿ãƒ³ã‚’ãƒãƒ¼ã‚ºã¨åŒã˜ä½ç½®ã« */
        }
        #reset-button {
            left: calc(50% + 70px); /* æœ€åˆã‹ã‚‰ãƒœã‚¿ãƒ³ã‚’ãƒãƒ¼ã‚ºã®å³ã«é…ç½® */
            background-color: #FF5722; /* è‰²ã‚’å¤‰ãˆã¦è¦–èªæ€§ã‚¢ãƒƒãƒ— */
        }
        #up-button, #down-button {
            position: absolute;
            right: 10px;
            width: 50px;
            height: 50px;
            font-size: 30px;
            background-color: #2196F3;
        }
        #up-button {
            bottom: 80px;
        }
        #down-button {
            bottom: 20px;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            color: red;
            z-index: 10;
        }
        #start-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            z-index: 20;
            opacity: 1;
            transition: opacity 1s ease-out;
        }
        #start-message.hidden {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <button id="pause-button" class="button" style="display: none;">ãƒãƒ¼ã‚º</button>
        <button id="resume-button" class="button" style="display: none;">å†é–‹</button>
        <button id="reset-button" class="button" style="display: none;">æœ€åˆã‹ã‚‰</button>
        <button id="up-button" class="button" style="display: none;">â†‘</button>
        <button id="down-button" class="button" style="display: none;">â†“</button>
        <div id="message" style="display: none;"></div>
        <div id="start-message">èµ°ã‚Œï¼</div>
    </div>
    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const pauseButton = document.getElementById('pause-button');
        const resumeButton = document.getElementById('resume-button');
        const resetButton = document.getElementById('reset-button');
        const upButton = document.getElementById('up-button');
        const downButton = document.getElementById('down-button');
        const message = document.getElementById('message');
        const startMessage = document.getElementById('start-message');

        let gameState = 'playing'; // åˆæœŸçŠ¶æ…‹ã‚’playingã«
        let characterImg = new Image();
        characterImg.src = 'https://github.com/user-attachments/assets/a879ea7d-4fa3-4185-b781-f146cf329be3';

        let character = { x: canvas.width - 100, y: 50, width: 50, height: 50, speed: 5 }; // å³å´ã«é…ç½®
        let obstacles = [];
        let goal = { x: 0, y: 0, width: 100, height: 1000, visible: false, animationOffset: 0 };
        let timer = 0; // ç§’æ•°ç®¡ç†ç”¨
        let scrollOffset = 0;
        let animationFrameId;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            character.x = canvas.width - 100; // å³å´ã«å›ºå®š
            character.y = canvas.height / 2 - character.height / 2;
            goal.y = 0;
            goal.height = canvas.height;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function drawBackground() {
            ctx.fillStyle = '#7CFC00'; // ç·‘ã®è‰åŸ
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawCharacter() {
            ctx.drawImage(characterImg, character.x, character.y, character.width, character.height);
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.font = '40px sans-serif';
                ctx.fillText('ğŸ”¥', obstacle.x - scrollOffset, obstacle.y + 40);
            });
        }

        function drawGoal() {
            if (goal.visible) {
                const waveAmplitude = 10;
                const waveFrequency = 0.1;
                goal.animationOffset += 0.05;
                const stripeHeight = 50; // ç¸æ¨¡æ§˜ã®é«˜ã•

                for (let y = 0; y < goal.height; y += stripeHeight) {
                    ctx.fillStyle = (Math.floor(y / stripeHeight) % 2 === 0) ? '#FFFFFF' : '#000000';
                    ctx.beginPath();
                    ctx.moveTo(goal.x, goal.y + y); // scrollOffsetã‚’å‰Šé™¤ã—ã€ç´”ç²‹ãªxåº§æ¨™ã‚’ä½¿ç”¨
                    for (let offsetY = 0; offsetY <= stripeHeight && y + offsetY <= goal.height; offsetY += 10) {
                        const waveOffset = Math.sin((y + offsetY) * waveFrequency + goal.animationOffset) * waveAmplitude;
                        ctx.lineTo(goal.x + waveOffset, goal.y + y + offsetY);
                    }
                    ctx.lineTo(goal.x, goal.y + y + stripeHeight);
                    ctx.closePath();
                    ctx.fill();
                }
            }
        }

        function update() {
            if (gameState === 'playing') {
                scrollOffset += 2;
                if (scrollOffset >= 2000) scrollOffset = 0;

                if (Math.random() < 0.02) {
                    let obstacle = {
                        x: -scrollOffset, // å·¦ã‹ã‚‰å‡ºç¾
                        y: Math.random() * (canvas.height - 50),
                        width: 40,
                        height: 40
                    };
                    obstacles.push(obstacle);
                }

                obstacles.forEach(obstacle => {
                    obstacle.x += 4; // å·¦ã‹ã‚‰å³ã«æµã‚Œã‚‹
                });

                obstacles = obstacles.filter(obstacle => obstacle.x - scrollOffset < canvas.width + 50);

                obstacles.forEach(obstacle => {
                    if (
                        character.x < obstacle.x - scrollOffset + obstacle.width &&
                        character.x + character.width > obstacle.x - scrollOffset &&
                        character.y < obstacle.y + obstacle.height &&
                        character.y + character.height > obstacle.y
                    ) {
                        gameState = 'gameover';
                        message.textContent = 'ï½¼ï¾ï¾ï½·ï¾ï½½ï½¶ï¾ğŸ¥º';
                        message.style.display = 'block';
                    }
                });

                timer += 1 / 60; // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
                if (timer >= 25 && !goal.visible) {
                    goal.visible = true; // 25ç§’çµŒéã§ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã‚’è¡¨ç¤º
                    goal.x = 0; // ç”»é¢å·¦ç«¯ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
                    console.log('Goal tape visible at timer:', timer, 'goal.x:', goal.x); // ãƒ‡ãƒãƒƒã‚°ç”¨
                }

                if (goal.visible) {
                    goal.x += 4; // ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã‚’å·¦ã‹ã‚‰å³ã«æµã™
                }

                // ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã«åˆ°é”ã—ãŸã‚‰ã‚¯ãƒªã‚¢
                if (goal.visible && character.x < goal.x) {
                    gameState = 'gameclear';
                    message.textContent = 'ãŠã‚ã§ã¨ã†ï¼ã—ã‚‡ãƒ¼ã‚“ã‚‚ãªğ–¤';
                    message.style.display = 'block';
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawCharacter();
            drawObstacles();
            drawGoal();
        }

        function gameLoop() {
            update();
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function startGame() {
            gameState = 'playing';
            pauseButton.style.display = 'block';
            resetButton.style.display = 'block';
            upButton.style.display = 'block';
            downButton.style.display = 'block';
            message.style.display = 'none';
            obstacles = [];
            scrollOffset = 0;
            timer = 0;
            goal.visible = false;
            goal.x = 0;
            goal.animationOffset = 0;
            character.x = canvas.width - 100;
            character.y = canvas.height / 2 - character.height / 2;

            // ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            startMessage.style.display = 'block';
            setTimeout(() => {
                startMessage.classList.add('hidden');
                setTimeout(() => {
                    startMessage.style.display = 'none';
                }, 1000); // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆå¾Œã«éè¡¨ç¤º
            }, 2000); // 2ç§’è¡¨ç¤º

            gameLoop();
        }

        function pauseGame() {
            gameState = 'paused';
            cancelAnimationFrame(animationFrameId);
            pauseButton.style.display = 'none';
            resumeButton.style.display = 'block';
            upButton.style.display = 'none';
            downButton.style.display = 'none';
        }

        function resumeGame() {
            gameState = 'playing';
            resumeButton.style.display = 'none';
            pauseButton.style.display = 'block';
            upButton.style.display = 'block';
            downButton.style.display = 'block';
            gameLoop();
        }

        function resetGame() {
            gameState = 'playing';
            cancelAnimationFrame(animationFrameId);
            pauseButton.style.display = 'block';
            resumeButton.style.display = 'none';
            resetButton.style.display = 'block';
            upButton.style.display = 'block';
            downButton.style.display = 'block';
            message.style.display = 'none';
            obstacles = [];
            scrollOffset = 0;
            timer = 0;
            goal.visible = false;
            goal.x = 0;
            goal.animationOffset = 0;
            character.x = canvas.width - 100;
            character.y = canvas.height / 2 - character.height / 2;

            // ãƒªã‚»ãƒƒãƒˆæ™‚ã«ã‚‚ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            startMessage.style.display = 'block';
            startMessage.classList.remove('hidden');
            setTimeout(() => {
                startMessage.classList.add('hidden');
                setTimeout(() => {
                    startMessage.style.display = 'none';
                }, 1000);
            }, 2000);

            gameLoop();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
        window.addEventListener('load', startGame);

        pauseButton.addEventListener('click', pauseGame);
        resumeButton.addEventListener('click', resumeGame);
        resetButton.addEventListener('click', resetGame);

        upButton.addEventListener('click', () => {
            if (gameState === 'playing') {
                character.y -= character.speed * 10;
                if (character.y < 0) character.y = 0;
            }
        });

        downButton.addEventListener('click', () => {
            if (gameState === 'playing') {
                character.y += character.speed * 10;
                if (character.y > canvas.height - character.height) character.y = canvas.height - character.height;
            }
        });
    </script>
</body>
</html>
